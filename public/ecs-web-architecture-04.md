---
title: ã€AWSã€‘ECSã‚’ç”¨ã„ãŸç°¡æ˜“webæ§‹ç¯‰â‘£(Dockerãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆNode.jsï¼‰)
tags:
  - 'AWS'
  - 'Docker'
  - 'Node.js'
private: true
updated_at: ''
id: null
organization_url_name: null
slide: false
ignorePublish: false
---

# ç¬¬4ç« ï¼šDockerãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆNode.jsï¼‰

æœ¬ç« ã§ã¯ã€**ECS ä¸Šã§å‹•ä½œã•ã›ã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­è¨ˆã¨ Docker åŒ–** ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

## ğŸ“š ç›®æ¬¡

* [1. æ§‹æˆã®èª¬æ˜](#1-æ§‹æˆã®èª¬æ˜)
* [2. ä½œæˆæ–¹æ³•](#2-ä½œæˆæ–¹æ³•)
* [3. ã‚³ãƒ¼ãƒ‰ã®è§£èª¬](#3-ã‚³ãƒ¼ãƒ‰ã®è§£èª¬)
* [4. æŒ¯ã‚Šè¿”ã‚Š](#4-æŒ¯ã‚Šè¿”ã‚Š)
* [5. å‚ç…§](#5-å‚ç…§)
* [6. ç”¨èª](#6-ç”¨èª)
* [7. ã‚³ãƒ¼ãƒ‰å…¨ä½“](#7-ã‚³ãƒ¼ãƒ‰å…¨ä½“)

---

## 1. æ§‹æˆã®èª¬æ˜

### ä½•ã‚’ã—ãŸã„ã‹

* ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆS3ï¼‰ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API** ã‚’å®Ÿè£…
* DynamoDB ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€JSON ã¨ã—ã¦è¿”å´
* S3 ä¸Šã®ç”»åƒã«å¯¾ã—ã¦ **ç½²åä»˜ãURL** ã‚’ç™ºè¡Œã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ç›´æ¥å‚ç…§å¯èƒ½ã«ã™ã‚‹
* ECSï¼ˆFargateï¼‰ã§å®Ÿè¡Œå¯èƒ½ãª **Docker ã‚³ãƒ³ãƒ†ãƒŠ** ã¨ã—ã¦æä¾›

---

### ã©ã‚“ãªæ§‹æˆã‹ãƒ»ä½•ãŒã§ãã‚‹ã‹

* **[**Node.js**](#nodejs)ï¼ˆ[**Express**](#express)ï¼‰ ã‚’ä½¿ç”¨**
* DynamoDB / S3 ã¸ã¯ [**AWS SDK**](#aws-sdk) ã‚’åˆ©ç”¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹
* èªè¨¼æƒ…å ±ã¯ã‚³ãƒ¼ãƒ‰ã«åŸ‹ã‚è¾¼ã¾ãšã€**ECS ã‚¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆIAM ãƒ­ãƒ¼ãƒ«ï¼‰** ã«ã‚ˆã£ã¦å–å¾—
* ã‚³ãƒ³ãƒ†ãƒŠã¯ ALB çµŒç”±ã§å¤–éƒ¨å…¬é–‹ï¼ˆè©³ç´°ã¯å¾Œç¶šç« ï¼‰

![**AWS SDK**](../images/ECS-web-architecture/ECS-DynamoDB-S3-CICD-arc.jpg)

---

### ãªãœã“ã®æ§‹æˆã«ã—ãŸã‹

* **ECS ã§å‹•ã‹ã™å‰æ** ã®ãŸã‚ã€ã‚¢ãƒ—ãƒªã¯ Docker åŒ–
* ã‚·ãƒ³ãƒ—ãƒ«ãª API ã®ãŸã‚ã€[**Express**](#express) ã‚’æ¡ç”¨
* ç”»åƒé…ä¿¡ã¯ API çµŒç”±ã§ã¯ãªãã€**S3 ã®ç½²åä»˜ãURLã‚’è¿”å´** ã™ã‚‹ã“ã¨ã§ã€

  * ECS ã®è² è·è»½æ¸›
  * å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ã®å›é¿
* IAM ãƒ­ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã€**ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’ç®¡ç†ã—ãªã„è¨­è¨ˆ** ã¨ã™ã‚‹

---

## 2. ä½œæˆæ–¹æ³•

### å‰ææ¡ä»¶

**ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ** ã«ä»¥ä¸‹ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¾ã™ã€‚

* **Node.jsï¼ˆ18.x ç³»ï¼‰**
  ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ APIï¼ˆExpressï¼‰ã‚’å®Ÿè£…ãƒ»å‹•ä½œç¢ºèªã™ã‚‹ãŸã‚ã«ä½¿ç”¨

* **Docker**
  ä½œæˆã—ãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’
  ECSï¼ˆFargateï¼‰ã§å®Ÿè¡Œå¯èƒ½ãª **ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ãƒ“ãƒ«ãƒ‰** ã™ã‚‹ãŸã‚ã«ä½¿ç”¨

* **AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆIAM æ¨©é™ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰**
  â€» æœ¬ç« ã§ã¯ç›´æ¥æ“ä½œã—ãªã„ãŒã€
  å¾Œç¶šç« ã§ ECSãƒ»IAMãƒ»ECR ã‚’åˆ©ç”¨ã™ã‚‹å‰æã¨ãªã‚‹

â€» å®Ÿéš›ã® ECS ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚„ IAM è¨­å®šã¯å¾Œç¶šç« ã§æ‰±ã„ã¾ã™ã€‚

---

### æ§‹ç¯‰ã®æµã‚Œï¼ˆæ¦‚è¦ï¼‰

1. [**Express**](#express) ã§ API ã‚’å®Ÿè£…
2. DynamoDB / S3 ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹å‡¦ç†ã‚’è¿½åŠ 
3. Dockerfile ã‚’ä½œæˆã—ã€ã‚³ãƒ³ãƒ†ãƒŠåŒ–
4. ECS ã§èµ·å‹•ã™ã‚‹ã“ã¨ã‚’å‰æã«ç’°å¢ƒå¤‰æ•°ã§è¨­å®šã‚’åˆ‡ã‚Šæ›¿ãˆ

---

### ä¸»ãªè¨­å®šæ–¹é‡ãƒ»æ³¨æ„ç‚¹

* **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«åãƒ»ãƒã‚±ãƒƒãƒˆåã¯ã™ã¹ã¦ç’°å¢ƒå¤‰æ•°**
* AWS èªè¨¼æƒ…å ±ã¯ **æ˜ç¤ºçš„ã«è¨­å®šã—ãªã„**
* CORS ã¯å­¦ç¿’ç”¨é€”ã®ãŸã‚ç·©ã‚ï¼ˆ`*`ï¼‰
  â€»æœ¬ç•ªã§ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«é™å®šã™ã‚‹å‰æ

---

## 3. ã‚³ãƒ¼ãƒ‰ã®è§£èª¬

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªï¼ˆapp.jsï¼‰

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»åŸºæœ¬è¨­å®š

```js
app.use(helmet());
app.use(cors({ origin: '*' }));
```

* [**helmet**](#helmet) ã«ã‚ˆã‚‹æœ€ä½é™ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€è¨­å®š
* [**CORS**](#cors) ã¯é–‹ç™ºãƒ»å­¦ç¿’ç”¨é€”ã®ãŸã‚å…¨è¨±å¯

---

#### DynamoDB æ¥ç¶šç¢ºèªï¼ˆèµ·å‹•æ™‚ï¼‰

```js
await docClient.send(new ScanCommand({
  TableName: process.env.DYNAMODB_TABLE_NAME,
  Limit: 1
}));
```

* èµ·å‹•æ™‚ã« DynamoDB ã¸ç–é€šç¢ºèª
* å¤±æ•—ã—ãŸå ´åˆã¯ **ã‚³ãƒ³ãƒ†ãƒŠã‚’å³çµ‚äº†**
* ECS ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ç•°å¸¸ã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•çš„ã«æ’é™¤å¯èƒ½

---

#### DynamoDB ãƒ‡ãƒ¼ã‚¿å–å¾— API

```js
app.get('/data', async (req, res) => {
  const command = new ScanCommand({ TableName: ... }); // ã€Œå…¨ä»¶å–å¾—ã—ã¦ã€ã¨ã„ã†å‘½ä»¤
  const result = await docClient.send(command); // å‘½ä»¤ã‚’å®Ÿè¡Œ
  res.json(result.Items); // çµæœã‚’JSONå½¢å¼ã§è¿”å´
});
```

* ã‚·ãƒ³ãƒ—ãƒ«ãª `Scan` ã«ã‚ˆã‚‹å…¨ä»¶å–å¾—ã€€ã€€

**Scanã¯ä¸‹è¨˜ç†ç”±ã‹ã‚‰å®Ÿé‹ç”¨ã§ã¯éæ¨å¥¨ã€‚**
* ã‚³ã‚¹ãƒˆå‰Šæ¸›: Scanã¯å…¨ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿ãŒå¢—ãˆã‚‹ã»ã©èª²é‡‘ãŒå¢—ãˆã‚‹ã€‚  
* ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦: Scanã¯ãƒ‡ãƒ¼ã‚¿é‡ã«æ¯”ä¾‹ã—ã¦é…ããªã‚‹ã€‚

**æ”¹å–„æ–¹æ³•**
* ã‚­ãƒ¼è¨­è¨ˆ: Queryã‚’ä½¿ã†ã«ã¯ã€ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆæ™‚ã«ã€Œãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã€ã‚’é©åˆ‡ã«è¨­å®šã™ã‚‹ã€‚

* IAMæ¨©é™ã®è¿½åŠ : IAMãƒãƒªã‚·ãƒ¼ã§ dynamodb:Query ã‚’è¨±å¯, dynamodb:Scanã‚’å‰Šé™¤ã€‚

* ç–é€šç¢ºèªæ–¹æ³•å¤‰æ›´: èµ·å‹•æ™‚ã®æ¥ç¶šãƒã‚§ãƒƒã‚¯ã« Scan ã‚„ Query ã‚’ä½¿ã†ã¨ç„¡é§„ãªèª­ã¿å–ã‚Šã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹ãŸã‚ã€ãƒ†ãƒ¼ãƒ–ãƒ«æƒ…å ±ã®å–å¾—ï¼ˆDescribeTableï¼‰ã‚’ä½¿ã†ã€‚



---

#### S3 ç½²åä»˜ã URL ç”Ÿæˆ API

```js
app.get('/image/*', async (req, res) => {
  const command = new GetObjectCommand({ Bucket: ..., Key: key });
  // ç½²åä»˜ã URLã‚’ä½œæˆã™ã‚‹
  const url = await getSignedUrl(s3Client, command, { expiresIn });
  res.json({ url });
});
```

* API ãŒç›´æ¥ç”»åƒã‚’è¿”å´ã—ãªã„æ§‹æˆ
* ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ S3 ã‹ã‚‰ **ç›´æ¥ç”»åƒã‚’å–å¾—**
* ECS å´ã®å¸¯åŸŸãƒ»è² è·ã‚’æŠ‘ãˆã‚‹è¨­è¨ˆ

---

### ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸæ™‚ã®å‡¦ç†, ã‚µãƒ¼ãƒãƒ¼ã®å¾…æ©Ÿé–‹å§‹

```js
// ã©ã“ã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„URLã«æ¥ãŸæ™‚ï¼ˆ404ã‚¨ãƒ©ãƒ¼ï¼‰
app.use((req, res) => { res.status(404).json({ error: 'Not Found' }); });

// ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
app.listen(port, () => console.log(`ğŸš€ Backend running on port ${port}`));
```

---

### Dockerfile ã®ãƒã‚¤ãƒ³ãƒˆ

```dockerfile
# 1. ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹OSï¼ˆNode.jsãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã®ã‚‚ã®ï¼‰ã‚’é¸ã¶
FROM node:18

# 2. ã‚³ãƒ³ãƒ†ãƒŠã®ä¸­ã§ã®ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆãƒ•ã‚©ãƒ«ãƒ€ï¼‰ã‚’æ±ºã‚ã‚‹
WORKDIR /app

# 3. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒªã‚¹ãƒˆï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã ã‘ã‚’å…ˆã«ã‚³ãƒ”ãƒ¼ã™ã‚‹
COPY package*.json ./

# 4. å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ˆnpm installï¼‰
RUN npm install

# 5. æ®‹ã‚Šã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚³ãƒ¼ãƒ‰ã‚’ã™ã¹ã¦ã‚³ãƒ”ãƒ¼ã™ã‚‹
COPY . .

# 6. 3000ç•ªãƒãƒ¼ãƒˆã‚’ä½¿ã†ã“ã¨ã‚’å®£è¨€ã™ã‚‹ï¼ˆãƒ¡ãƒ¢æ›¸ãã®ã‚ˆã†ãªã‚‚ã®ï¼‰
EXPOSE 3000

# 7. ã‚³ãƒ³ãƒ†ãƒŠãŒå‹•ãå‡ºã—ãŸæ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ï¼ˆã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼‰
CMD ["npm", "start"]
```


---

## 4. æŒ¯ã‚Šè¿”ã‚Š

### æ”¹å–„ã§ãã‚‹ã¨ã“ã‚

* DynamoDB ã®å–å¾—å‡¦ç†ã‚’ `Query` ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´
* CORS è¨­å®šã®å³æ ¼åŒ–
* Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºã®å‰Šæ¸›ï¼ˆ[ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸](#ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸)ï¼‰

---

### æ¬¡ã«ã‚„ã‚‹ã“ã¨

æ¬¡ç« ã§ã¯ã€
**ã“ã® Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ ECSï¼ˆFargateï¼‰ä¸Šã§å®Ÿè¡Œã—ã€ALB çµŒç”±ã§å…¬é–‹** ã™ã‚‹æ§‹æˆã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

* **[â‘ æ§‹æˆã®èª¬æ˜]()**  
* **[â‘¡S3(é™çš„Webã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°)/ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰]()**  
* **[â‘¢VPCé–¢é€£]()**  
* **[â‘£Docker/ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰]()**  
* **[â‘¤ECS + ALB]()**  
* **[â‘¥DynamoDBãƒ»S3é€£æº]()**  
* **[â‘¦CI/CD(ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³)]()** 
* **[â‘§CI/CD(ã‚¤ãƒ³ãƒ•ãƒ©)]()**


---

## 5. å‚ç…§

* [Dockerå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.docker.com/)
* [Node.jså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://nodejs.jp/docs)

---

## 6. ç”¨èª

### AWS SDK
ç‰¹å®šã®AWSã‚µãƒ¼ãƒ“ã‚¹ï¼ˆS3ã‚„DynamoDBãªã©ï¼‰ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰æ“ä½œã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«é›†ã€‚  
SDKãŒä¸€æ™‚çš„ãªæ¨©é™ã‚’å–å¾—ã—èªè¨¼ã‚’è‡ªå‹•åŒ–ã§ãã‚‹ã€‚

### Node.js
æœ¬æ¥Webãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ã—ã‹å‹•ä½œã—ãªã„JavaScriptã‚’ãƒ‘ã‚½ã‚³ãƒ³ã‚„ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ã‚‚å‹•ã‹ã›ã‚‹ã‚ˆã†ã«ã—ãŸå®Ÿè¡Œç’°å¢ƒã€‚

### Express
Node.jsã®ä¸Šã§å‹•ä½œã™ã‚‹ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„APIã‚’é–‹ç™ºã™ã‚‹ãŸã‚ã®å®šç•ªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚

### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
ç‰¹å®šã®æ©Ÿèƒ½ã‚’æŒã¤ã‚³ãƒ¼ãƒ‰ã‚’ã€é…å¸ƒãƒ»å°å…¥ã—ã‚„ã™ã„ã‚ˆã†ã«ä¸€ã¤ã«ã¾ã¨ã‚ãŸã‚‚ã®ã€‚
Node.jsã§ã¯npmãªã©ã®ç®¡ç†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã„ç®¡ç†ã§ãã‚‹ã€‚

### ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
ç‰¹å®šã®æ©Ÿèƒ½ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ç‹¬ç«‹ã—ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã•ã‚ŒãŸä½¿ã„å›ã—ãŒã§ãã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®é›†ã¾ã‚Šã€‚

### SDK
ç‰¹å®šã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å‘ã‘ã®ã‚½ãƒ•ãƒˆã‚’ä½œã‚‹ãŸã‚ã«å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚»ãƒƒãƒˆã«ãªã£ãŸã‚‚ã®ã€‚

### ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
é–‹ç™ºã‚’åŠ¹ç‡çš„ã«ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é›†ã‚ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é››å½¢ã€‚  
ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆéƒ¨å“ï¼‰ã‚’ã©ã†çµ„ã¿åˆã‚ã›ã‚‹ã‹ã¨ã„ã†ã€Œæ§‹é€ ã‚„ãƒ«ãƒ¼ãƒ«ã€ã¾ã§ã‚’å«ã‚“ã å¤§ããªä»•çµ„ã¿ã‚’æŒ‡ã™ã€‚  
æ çµ„ã¿ã®ä¸­ã«å¿…è¦ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãè¾¼ã‚€ãŸã‚ã€ã‚³ãƒ¼ãƒ‰ã®æ§‹é€ ã«ä¸€è²«æ€§ã‚’æŒãŸã›ã‚‰ã‚Œã‚‹ã€‚

### helmet 
Express ã‚¢ãƒ—ãƒªã«å¯¾ã—ã¦
ã‚ˆãã‚ã‚‹ Web æ”»æ’ƒã¸ã®è€æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã® HTTP ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ã‚’è‡ªå‹•çš„ã«ä»˜ä¸ã™ã‚‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã€‚

### CORS
ã‚ã‚‹Webã‚µã‚¤ãƒˆã‹ã‚‰ã€åˆ¥ã®Webã‚µã‚¤ãƒˆï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ãªã©ï¼‰ã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‚å®‰å…¨ã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã—ã€è¨±å¯ã™ã‚‹ä»•çµ„ã¿ã€‚

### ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸
ã€Œãƒ“ãƒ«ãƒ‰ç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠã€ã¨ã€Œå®Ÿè¡Œç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠã€ã‚’åˆ†ã‘ã‚‹ã“ã¨ã€‚
Stage 1 (ãƒ“ãƒ«ãƒ‰ç”¨): npm install ã‚’è¡Œã„ã€ãƒ“ãƒ«ãƒ‰ã«å¿…è¦ãªå…¨ã¦ã®ãƒ„ãƒ¼ãƒ«ã‚’å…¥ã‚Œã‚‹ã€‚
Stage 2 (å®Ÿè¡Œç”¨): Stage 1ã§ä½œã‚‰ã‚ŒãŸæˆæœç‰©ï¼ˆnode_modulesãªã©ï¼‰ã ã‘ã‚’ã‚³ãƒ”ãƒ¼ã—ã€è»½é‡ãªOSã§å‹•ã‹ã™ã€‚
ãƒ¡ãƒªãƒƒãƒˆ: æœ€çµ‚çš„ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚„ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ãŒå«ã¾ã‚Œãªã„ãŸã‚è»½é‡ã€‚

---

## 7. ã‚³ãƒ¼ãƒ‰å…¨ä½“

```docker
FROM node:18

# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¨­å®š
WORKDIR /app

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY package*.json ./
RUN npm install

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
COPY . .

# ã‚¢ãƒ—ãƒªãŒä½¿ç”¨ã™ã‚‹ãƒãƒ¼ãƒˆã‚’é–‹æ”¾
EXPOSE 3000

# ã‚¢ãƒ—ãƒªèµ·å‹•ã‚³ãƒãƒ³ãƒ‰
CMD ["npm", "start"]

```

```js
const express = require('express');
const { DynamoDBClient } = require('@aws-sdk/client-dynamodb');
const { DynamoDBDocumentClient, ScanCommand } = require('@aws-sdk/lib-dynamodb');
const { S3Client, GetObjectCommand } = require('@aws-sdk/client-s3');
const { getSignedUrl } = require('@aws-sdk/s3-request-presigner');
const helmet = require('helmet');

const app = express();
const port = process.env.PORT || 3000;

app.use(helmet()); // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Š

// DynamoDBè¨­å®š
const dynamoClient = new DynamoDBClient({ region: process.env.AWS_REGION });
const docClient = DynamoDBDocumentClient.from(dynamoClient);

// S3ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
const s3Client = new S3Client({ region: process.env.AWS_REGION });

// èµ·å‹•æ™‚ã«DynamoDBæ¥ç¶šç¢ºèª
(async () => {
  try {
    await docClient.send(new ScanCommand({
      TableName: process.env.DYNAMODB_TABLE_NAME,
      Limit: 1
    }));
    console.log('âœ… DynamoDBæ¥ç¶šç¢ºèªã«æˆåŠŸã—ã¾ã—ãŸ');
  } catch (err) {
    console.error('âŒ DynamoDBæ¥ç¶šã‚¨ãƒ©ãƒ¼:', err.message);
    process.exit(1); // èµ·å‹•ä¸­æ­¢
  }
})();

// Expressã§ã®CORSå¯¾å¿œä¾‹
const cors = require('cors');
app.use(cors({
  origin: '*', // é–‹ç™ºæ™‚ã®ã¿ * ã‚’è¨±å¯ã€‚æœ¬ç•ªã¯ãƒ•ãƒ­ãƒ³ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æŒ‡å®šã€‚å›ºå®šãƒ‰ãƒ¡ã‚¤ãƒ³ãŒãªã„ã®ã§é–‹ç™ºç’°å¢ƒã§ã¯*ã§é‹ç”¨
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type']
}));



app.get('/', (req, res) => {
  res.status(200).send('OK');
});


// ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
app.get('/data', async (req, res) => {
  try {
    const command = new ScanCommand({
      TableName: process.env.DYNAMODB_TABLE_NAME
    });
    const result = await docClient.send(command);
    res.json(result.Items);
  } catch (err) {
    console.error('DynamoDBå–å¾—ã‚¨ãƒ©ãƒ¼:', err.message);
    res.status(500).json({ error: 'ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ' });
  }
});

// S3ç½²åä»˜ãURLè¿”å´ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
app.get('/image/*', async (req, res) => {
  const key = req.params[0];

  console.log("âœ… ãƒã‚±ãƒƒãƒˆå:", process.env.S3_BUCKET);
  console.log("âœ… ç”»åƒã‚­ãƒ¼:", key);

  if (!key || typeof key !== 'string' || key.trim() === '') {
    console.warn('âš ï¸ ä¸æ­£ãªã‚­ãƒ¼ãŒæ¸¡ã•ã‚Œã¾ã—ãŸ:', key);
    return res.status(400).json({ error: 'ç„¡åŠ¹ãªç”»åƒã‚­ãƒ¼ã§ã™' });
  }
  try {
    const expiresIn = parseInt(process.env.S3_URL_EXPIRES || '300', 10); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ300ç§’

    const command = new GetObjectCommand({
      Bucket: process.env.S3_BUCKET,
      Key: key,
    });

    const url = await getSignedUrl(s3Client, command, { expiresIn });

    console.log("âœ… ç”Ÿæˆã•ã‚ŒãŸç½²åä»˜ãURL:", url);

    res.json({ url });
  } catch (err) {
    console.error('S3ç½²åURLç”Ÿæˆã‚¨ãƒ©ãƒ¼:', err.message);
    res.status(500).json({ error: 'ç”»åƒURLã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ' });
  }
});

// æœªå®šç¾©ãƒ«ãƒ¼ãƒˆ
app.use((req, res) => {
  res.status(404).json({ error: 'Not Found' });
});

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©
app.use((err, req, res, next) => {
  console.error('äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼:', err);
  res.status(500).json({ error: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' });
});

app.listen(port, () => console.log(`ğŸš€ Backend running on port ${port}`));

```